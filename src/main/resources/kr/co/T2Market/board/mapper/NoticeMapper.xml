<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.T2Market.board.mapper.NoticeMapper">

	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item="type" collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type=='T'.toString()">
							title like '%'||#{keyword}||'%'
						</when>					
						<when test="type=='C'.toString()">
							content like '%'||#{keyword}||'%'
						</when>	
						<when test="type=='W'.toString()">
							writer like '%'||#{keyword}||'%'
						</when>								
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>

	<select id="getList" resultType="kr.co.T2Market.board.domain.NoticeVO">
		<![CDATA[
			SELECT * FROM NOTICE 
			WHERE NOTICE_NO > 0
			  AND ACTIVE='Y'
		]]>
	</select>
	
	<insert id="insert">
		insert into notice (notice_no, admin_id, title, content, active, regdate, updatedate)
			values(seq_admin_notice_no.nextval, #{admin_id}, #{title}, #{content}, 'Y', sysdate, sysdate)
	</insert>
	
	<select id="read" resultType="kr.co.T2Market.board.domain.NoticeVO">
		select * from notice where notice_no = #{notice_no}
	</select>

	<update id="update">
		update notice
		set title = #{title},
			content = #{content},
			active = #{active},
			updatedate = sysdate
		where notice_no = #{notice_no}
	</update>
	
	<select id="getListWithPaging" resultType="kr.co.T2Market.board.domain.NoticeVO">
		<![CDATA[
			select 
			    notice_no, admin_id, title, content, active, regdate, updatedate
		    from 
		      (
			      select /*+INDEX_DESC(notice pk_notice) */
			        notice_no, admin_id, title, content, active, regdate, updatedate 
			      from 
			        notice
			      where 
		 ]]>  
			      
			<include refid="criteria"></include><!-- <<<여기 인클루드 해둔게 정의가 안돼있었어 그래서 위에 추가함 -->
			
		<![CDATA[	      
			      notice_no <= #{pageNum} * #{amount}
			   )
			 where notice_no > (#{pageNum} -1) * #{amount}
		]]>
	</select>
	
	<select id="getTotalCount" resultType="int">
		select count(*) from notice 		
		where 
		<include refid="criteria"></include>
		notice_no>0
	</select>

</mapper>
